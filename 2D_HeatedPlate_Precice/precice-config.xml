<?xml version="1.0"?>

<precice-configuration>

    <log>   
        <sink type="stream" output="stdout" filter="%Severity% > debug and %Rank% = 0" format="---[precice] %ColorizedSeverity% %Message%" enabled="true"/>
    </log>

    <solver-interface dimensions="2">

        <data:scalar name="Temperature_Lower"/>
        <data:scalar name="Temperature_Upper"/>

        <mesh name="Lower_Plate_Mesh">
            <use-data name="Temperature_Lower"/>
            <use-data name="Temperature_Upper"/>
        </mesh>

        <mesh name="Upper_Plate_Mesh">
            <use-data name="Temperature_Lower"/>
            <use-data name="Temperature_Upper"/>
        </mesh>

        <participant name="Lower_Plate">
            <use-mesh name="Lower_Plate_Mesh" provide="yes"/>
            <use-mesh name="Upper_Plate_Mesh" from="Upper_Plate"/>
            <!--import temperature from upper plate before next iteration-->
            <read-data name="Temperature_Upper" mesh="Lower_Plate_Mesh"/>
            <!--export calculated temperature for the upper plate next iteration-->
            <write-data name="Temperature_Lower" mesh="Lower_Plate_Mesh"/>
            <mapping:nearest-neighbor direction="read" from="Upper_Plate_Mesh" to="Lower_Plate_Mesh" constraint="consistent"/>
        </participant>

        <participant name="Upper_Plate">
            <use-mesh name="Upper_Plate_Mesh" provide="yes"/>
            <use-mesh name="Lower_Plate_Mesh" from="Lower_Plate"/>
            <read-data name="Temperature_Lower" mesh="Upper_Plate_Mesh"/>
            <write-data name="Temperature_Upper" mesh="Upper_Plate_Mesh"/>
            <mapping:nearest-neighbor direction="read" from="Lower_Plate_Mesh" to="Upper_Plate_Mesh" constraint="consistent"/>
        </participant>

        <m2n:sockets from="Lower_Plate_Mesh" to="Upper_Plate_Mesh"/>

        <coupling-scheme:serial-implicit>
            <time-window-size value="0.01"/>
            <max-time value="1"/>
            <max-iterations value="200"/>
            <participants first="Lower_Plate" second="Upper_Plate"/>
            <exchange data="Temperature_Lower" mesh="Lower_Plate_Mesh" from="Lower_Plate" to="Upper_Plate"/>
            <exchange data="Temperature_Upper" mesh="Lower_Plate_Mesh" from="Upper_Plate" to="Lower_Plate"/>
            <relative-convergence-measure limit="1.0e-6" data="Temperature_Lower" mesh="Lower_Plate"/>
            <extrapolation-order value="0"/>
            <acceleration:IQN-ILS>
                <data mesh="Lower_Plate" name="Temperature_Upper" />
                <initial-relaxation value="0.01" />
                <max-used-iterations value="80" />
                <time-windows-reused value="10" />
                <filter type="QR1" limit="1e-8" />
            </acceleration:IQN-ILS>
        </coupling-scheme:serial-implicit>

        
        <!-- <coupling-scheme:serial-explicit> 
          <participants first="Lower_Plate" second="Upper_Plate" /> 
          <max-time-windows value="10" />
          <time-window-length value="1.0" />
          <exchange data="Temperature_Lower"     mesh="Lower_Plate_Mesh" from="Lower_Plate" to="Upper_Plate" />
          <exchange data="Temperature_Upper" mesh="Lower_Plate_Mesh" from="Upper_Plate" to="Lower_Plate"/>
        </coupling-scheme:serial-explicit> -->
   
        

    </solver-interface>    

</precice-configuration>